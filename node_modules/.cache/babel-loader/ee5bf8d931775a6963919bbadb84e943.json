{"ast":null,"code":"var _jsxFileName = \"/home/raven/Documents/programming/proyects/addresses_app/bery/addresses_app/src/ui-component/addresses/maps/mapbox/index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useEffect, useState } from 'react';\nimport './css/markersStyle.css';\nimport './css/index.css';\nimport ReactMapGL, { Layer } from 'react-map-gl';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\n// Redux\n\nimport { useDispatch, useSelector } from \"react-redux\"; // Actions\n\nimport { updatePositionAction, getFromUserPositionAction, createPositionAction, getAllDomiciliarioAction } from \"../../../../store/storeAddresses/store/reducer\"; //console.log('MAPBOXGL', mapboxgl)\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nmapboxgl.accessToken = 'pk.eyJ1Ijoic2ViYXN0aWFuY3JvdyIsImEiOiJja3VnOW5yazUwanYwMm9waHY1NWdoaHRnIn0.kIsU3HWfUybUwU2DvavkwA';\nconst stores = {\n  \"type\": \"FeatureCollection\",\n  \"features\": [{\n    \"type\": \"Feature\",\n    \"geometry\": {\n      \"type\": \"Point\",\n      \"coordinates\": [-75.512527, 6.343636]\n    },\n    \"properties\": {\n      \"phoneFormatted\": \"3195158887\",\n      \"phone\": \"2022347336\",\n      \"address\": \"Carrera 57A N# 48-43\",\n      \"city\": \"Copacabana\",\n      \"country\": \"Colombia\",\n      \"crossStreet\": \"at 15th St NW\",\n      \"postalCode\": \"050022\" //\"state\": \"D.C.\"\n\n    }\n  }, {\n    \"type\": \"Feature\",\n    \"geometry\": {\n      \"type\": \"Point\",\n      \"coordinates\": [-75.561148, 6.259861]\n    },\n    \"properties\": {\n      \"phoneFormatted\": \"21171157\",\n      \"phone\": \"21171157\",\n      \"address\": \"Calle 64 #154, Medellín, Antioquia\",\n      \"city\": \"Medellin\",\n      \"country\": \"Colombia\",\n      \"crossStreet\": \"at 15th St NW\",\n      \"postalCode\": \"050022\" //\"state\": \"D.C.\"\n\n    }\n  }]\n};\n/* Assign a unique ID to each store */\n\nstores.features.forEach(function (store, i) {\n  store.properties.id = i;\n});\nexport const MapBox = () => {\n  _s();\n\n  const dispatch = useDispatch();\n  const userID = useSelector(state => state.login.usuario.user._id);\n  const position = useSelector(state => state.ui.position);\n  const positionId = useSelector(state => state.ui.positionId);\n  const user = useSelector(state => state.login.usuario.user);\n  useEffect(() => {\n    const timer = setInterval(() => {\n      dispatch(getFromUserPositionAction(userID));\n      const options = {\n        enableHighAccuracy: true,\n        timeout: 5000,\n        maximumAge: 0\n      };\n\n      function success(pos) {\n        var crd = pos.coords;\n\n        if (positionId) {\n          dispatch(updatePositionAction({\n            lat: crd.latitude,\n            lng: crd.longitude,\n            positionId: positionId\n          }));\n        } else {\n          dispatch(createPositionAction({\n            position: JSON.stringify({\n              lat: crd.latitude,\n              lng: crd.longitude\n            }),\n            usuario: userID\n          }));\n        }\n      }\n\n      ;\n\n      function error(err) {\n        console.warn('ERROR(' + err.code + '): ' + err.message);\n      }\n\n      ;\n      navigator.geolocation.getCurrentPosition(success, error, options);\n    }, 5000);\n    return () => clearTimeout(timer);\n  }, [dispatch, position, positionId, userID]); //console.log('POSITION', position)\n\n  const userPosition = JSON.parse(position.replace(/'/g, '\"'));\n  const mapContainer = useRef(null);\n  const map = useRef(null);\n  const [lng, setLng] = useState(userPosition.lng);\n  const [lat, setLat] = useState(userPosition.lat);\n  const [zoom, setZoom] = useState(13);\n\n  const buildLocationList = ({\n    features\n  }) => {\n    for (const {\n      properties\n    } of features) {\n      /* Add a new listing section to the sidebar. */\n      const listings = document.getElementById('listings');\n      const listing = listings.appendChild(document.createElement('div'));\n      /* Assign a unique `id` to the listing. */\n\n      listing.id = `listing-${properties.id}`;\n      /* Assign the `item` class to each listing for styling. */\n\n      listing.className = 'item';\n      /* Add the link to the individual listing created above. */\n\n      const link = listing.appendChild(document.createElement('a'));\n      link.href = '#';\n      link.className = 'title';\n      link.id = `link-${properties.id}`;\n      link.innerHTML = `${properties.address}`;\n      /* Add details to the individual listing. */\n\n      const details = listing.appendChild(document.createElement('div'));\n      details.innerHTML = `${properties.city}`;\n\n      if (properties.phone) {\n        details.innerHTML += ` · ${properties.phoneFormatted}`;\n      }\n\n      if (properties.distance) {\n        const roundedDistance = Math.round(properties.distance * 100) / 100;\n        details.innerHTML += `<div><strong>${roundedDistance} miles away</strong></div>`;\n      } // Event Listener\n\n\n      link.addEventListener('click', function () {\n        for (const feature of features) {\n          if (this.id === `link-${feature.properties.id}`) {\n            flyToStore(feature);\n            createPopUp(feature);\n          }\n        }\n\n        const activeItem = document.getElementsByClassName('active');\n\n        if (activeItem[0]) {\n          activeItem[0].classList.remove('active');\n        }\n\n        this.parentNode.classList.add('active');\n      });\n    }\n  };\n\n  const flyToStore = currentFeature => {\n    map.current.flyTo({\n      center: currentFeature.geometry.coordinates,\n      zoom: 15\n    });\n  };\n\n  const createPopUp = currentFeature => {\n    const popUps = document.getElementsByClassName('mapboxgl-popup');\n    /** Check if there is already a popup on the map and if so, remove it */\n\n    if (popUps[0]) popUps[0].remove();\n    const popup = new mapboxgl.Popup({\n      closeOnClick: false\n    }).setLngLat(currentFeature.geometry.coordinates).setHTML(`<h3>Addresss</h3><h4>${currentFeature.properties.address}</h4>`).addTo(map.current);\n  };\n\n  useEffect(() => {\n    if (map.current) return; // initialize map only once\n\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: 'mapbox://styles/mapbox/streets-v11',\n      center: [lng, lat],\n      //center: [-77.034084, 38.909671],\n      zoom: zoom\n    });\n    map.current.on('load', () => {\n      /* Add the data to your map as a layer \n      \n      map.current.addLayer({\n        id: 'locations',\n        type: 'circle',\n        // Add a GeoJSON source containing place coordinates and information.\n        source: {\n          type: 'geojson',\n          data: stores\n        }\n      });\n      */\n      // This function is for to load custom markers\n      map.current.addSource('places', {\n        type: 'geojson',\n        data: stores\n      });\n      buildLocationList(stores);\n      addMarkers();\n    });\n\n    const addMarkers = () => {\n      /* For each feature in the GeoJSON object above: */\n      for (const marker of stores.features) {\n        /* Create a div element for the marker. */\n        const el = document.createElement('div');\n        /* Assign a unique `id` to the marker. */\n\n        el.id = `marker-${marker.properties.id}`;\n        /* Assign the `marker` class to each marker for styling. */\n\n        el.className = 'marker';\n        /**\n         * Create a marker using the div element\n         * defined above and add it to the map.\n         **/\n\n        new mapboxgl.Marker(el, {\n          offset: [0, -23]\n        }).setLngLat(marker.geometry.coordinates).addTo(map.current);\n        el.addEventListener('click', e => {\n          /* Fly to the point */\n          flyToStore(marker);\n          /* Close all other popups and display popup for clicked store */\n\n          createPopUp(marker);\n          /* Highlight listing in sidebar */\n\n          const activeItem = document.getElementsByClassName('active');\n          e.stopPropagation();\n\n          if (activeItem[0]) {\n            activeItem[0].classList.remove('active');\n          }\n\n          const listing = document.getElementById(`listing-${marker.properties.id}`);\n          listing.classList.add('active');\n        });\n      }\n    };\n    /*\n    map.current.on('click', ({ point }) => {\n      // Determine if a feature in the \"locations\" layer exists at that point. \n      const features = map.current.queryRenderedFeatures(point, {\n        layers: ['locations']\n      });\n             // If it does not exist, return \n      if (!features.length) return;\n             const clickedPoint = features[0];\n             //Fly to the point \n      flyToStore(clickedPoint);\n             // Close all other popups and display popup for clicked store \n      createPopUp(clickedPoint);\n             // Highlight listing in sidebar (and remove highlight for all other listings) \n      const activeItem = document.getElementsByClassName('active');\n      if (activeItem[0]) {\n        activeItem[0].classList.remove('active');\n      }\n      const listing = document.getElementById(\n        `listing-${clickedPoint.properties.id}`\n      );\n      listing.classList.add('active');\n    });\n    */\n\n  });\n  useEffect(() => {\n    if (!map.current) return; // wait for map to initialize\n\n    map.current.on('move', () => {\n      setLng(map.current.getCenter().lng.toFixed(4));\n      setLat(map.current.getCenter().lat.toFixed(4));\n      setZoom(map.current.getZoom().toFixed(2));\n    });\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"heading\",\n        children: /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"Dealer Orders\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"listings\",\n        className: \"listings\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapContainer,\n      className: \"map\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 298,\n    columnNumber: 9\n  }, this);\n}; //Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}\n\n_s(MapBox, \"R/IqDq6rh3h8OtwpopHSCBOcEzg=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = MapBox;\n\nvar _c;\n\n$RefreshReg$(_c, \"MapBox\");","map":{"version":3,"sources":["/home/raven/Documents/programming/proyects/addresses_app/bery/addresses_app/src/ui-component/addresses/maps/mapbox/index.js"],"names":["React","useRef","useEffect","useState","ReactMapGL","Layer","mapboxgl","useDispatch","useSelector","updatePositionAction","getFromUserPositionAction","createPositionAction","getAllDomiciliarioAction","accessToken","stores","features","forEach","store","i","properties","id","MapBox","dispatch","userID","state","login","usuario","user","_id","position","ui","positionId","timer","setInterval","options","enableHighAccuracy","timeout","maximumAge","success","pos","crd","coords","lat","latitude","lng","longitude","JSON","stringify","error","err","console","warn","code","message","navigator","geolocation","getCurrentPosition","clearTimeout","userPosition","parse","replace","mapContainer","map","setLng","setLat","zoom","setZoom","buildLocationList","listings","document","getElementById","listing","appendChild","createElement","className","link","href","innerHTML","address","details","city","phone","phoneFormatted","distance","roundedDistance","Math","round","addEventListener","feature","flyToStore","createPopUp","activeItem","getElementsByClassName","classList","remove","parentNode","add","currentFeature","current","flyTo","center","geometry","coordinates","popUps","popup","Popup","closeOnClick","setLngLat","setHTML","addTo","Map","container","style","on","addSource","type","data","addMarkers","marker","el","Marker","offset","e","stopPropagation","getCenter","toFixed","getZoom"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport './css/markersStyle.css'\nimport './css/index.css'\nimport ReactMapGL, { Layer } from 'react-map-gl';\nimport mapboxgl from '!mapbox-gl'; // eslint-disable-line import/no-webpack-loader-syntax\n\n// Redux\nimport { useDispatch, useSelector } from \"react-redux\";\n\n// Actions\nimport { \n    updatePositionAction, \n    getFromUserPositionAction, \n    createPositionAction, \n    getAllDomiciliarioAction \n} from \"../../../../store/storeAddresses/store/reducer\";\n\n\n//console.log('MAPBOXGL', mapboxgl)\nmapboxgl.accessToken = 'pk.eyJ1Ijoic2ViYXN0aWFuY3JvdyIsImEiOiJja3VnOW5yazUwanYwMm9waHY1NWdoaHRnIn0.kIsU3HWfUybUwU2DvavkwA';\n\n\nconst stores = {\n    \"type\": \"FeatureCollection\",\n    \"features\": [\n        {\n            \"type\": \"Feature\",\n            \"geometry\": {\n                \"type\": \"Point\",\n                \"coordinates\": [\n                    -75.512527,\n                    6.343636\n                ]\n            },\n            \"properties\": {\n                \"phoneFormatted\": \"3195158887\",\n                \"phone\": \"2022347336\",\n                \"address\": \"Carrera 57A N# 48-43\",\n                \"city\": \"Copacabana\",\n                \"country\": \"Colombia\",\n                \"crossStreet\": \"at 15th St NW\",\n                \"postalCode\": \"050022\",\n                //\"state\": \"D.C.\"\n            }\n        },\n        {\n            \"type\": \"Feature\",\n            \"geometry\": {\n                \"type\": \"Point\",\n                \"coordinates\": [\n                    -75.561148,\n                    6.259861\n                ]\n            },\n            \"properties\": {\n                \"phoneFormatted\": \"21171157\",\n                \"phone\": \"21171157\",\n                \"address\": \"Calle 64 #154, Medellín, Antioquia\",\n                \"city\": \"Medellin\",\n                \"country\": \"Colombia\",\n                \"crossStreet\": \"at 15th St NW\",\n                \"postalCode\": \"050022\",\n                //\"state\": \"D.C.\"\n            }\n        },\n    ]\n}\n\n/* Assign a unique ID to each store */\nstores.features.forEach(function (store, i) {\n    store.properties.id = i;\n});\n\n\nexport const MapBox = () => {\n\n    const dispatch = useDispatch();\n    const userID = useSelector((state) => state.login.usuario.user._id);\n    const position = useSelector((state) => state.ui.position);\n    const positionId = useSelector((state) => state.ui.positionId);\n    const user = useSelector((state) => state.login.usuario.user)\n  \n    useEffect(() => {\n      const timer = setInterval(() => {\n        dispatch(getFromUserPositionAction(userID));\n        const options = {\n          enableHighAccuracy: true,\n          timeout: 5000,\n          maximumAge: 0\n        };\n  \n        function success(pos) {\n          var crd = pos.coords;\n          if (positionId) {\n            dispatch(updatePositionAction({ lat: crd.latitude, lng: crd.longitude, positionId: positionId }));\n          } else {\n            dispatch(createPositionAction({ position: JSON.stringify({ lat: crd.latitude, lng: crd.longitude }), usuario: userID }));\n          }\n        };\n  \n        function error(err) {\n          console.warn('ERROR(' + err.code + '): ' + err.message);\n        };\n  \n        navigator.geolocation.getCurrentPosition(success, error, options);\n      }, 5000);\n  \n      return () => clearTimeout(timer);\n    }, [dispatch, position, positionId, userID]);\n\n\n\n    //console.log('POSITION', position)\n    const userPosition = JSON.parse(position.replace(/'/g, '\"'))\n    \n\n    const mapContainer = useRef(null);\n    const map = useRef(null);\n    const [lng, setLng] = useState(userPosition.lng);\n    const [lat, setLat] = useState(userPosition.lat);\n    const [zoom, setZoom] = useState(13);\n\n\n\n\n    const buildLocationList = ({ features }) => {\n        for (const { properties } of features) {\n            /* Add a new listing section to the sidebar. */\n            const listings = document.getElementById('listings');\n            const listing = listings.appendChild(document.createElement('div'));\n            /* Assign a unique `id` to the listing. */\n            listing.id = `listing-${properties.id}`;\n            /* Assign the `item` class to each listing for styling. */\n            listing.className = 'item';\n\n            /* Add the link to the individual listing created above. */\n            const link = listing.appendChild(document.createElement('a'));\n            link.href = '#';\n            link.className = 'title';\n            link.id = `link-${properties.id}`;\n            link.innerHTML = `${properties.address}`;\n\n            /* Add details to the individual listing. */\n            const details = listing.appendChild(document.createElement('div'));\n            details.innerHTML = `${properties.city}`;\n            if (properties.phone) {\n                details.innerHTML += ` · ${properties.phoneFormatted}`;\n            }\n            if (properties.distance) {\n                const roundedDistance = Math.round(properties.distance * 100) / 100;\n                details.innerHTML += `<div><strong>${roundedDistance} miles away</strong></div>`;\n            }\n\n            // Event Listener\n            link.addEventListener('click', function () {\n                for (const feature of features) {\n                    if (this.id === `link-${feature.properties.id}`) {\n                        flyToStore(feature);\n                        createPopUp(feature);\n                    }\n                }\n                const activeItem = document.getElementsByClassName('active');\n                if (activeItem[0]) {\n                    activeItem[0].classList.remove('active');\n                }\n                this.parentNode.classList.add('active');\n            });\n        }\n    }\n\n    const flyToStore = (currentFeature) => {\n        map.current.flyTo({\n            center: currentFeature.geometry.coordinates,\n            zoom: 15\n        });\n    }\n\n    const createPopUp = (currentFeature) => {\n        const popUps = document.getElementsByClassName('mapboxgl-popup');\n        /** Check if there is already a popup on the map and if so, remove it */\n        if (popUps[0]) popUps[0].remove();\n\n        const popup = new mapboxgl.Popup({ closeOnClick: false })\n            .setLngLat(currentFeature.geometry.coordinates)\n            .setHTML(`<h3>Addresss</h3><h4>${currentFeature.properties.address}</h4>`)\n            .addTo(map.current);\n    }\n\n\n\n    useEffect(() => {\n        if (map.current) return; // initialize map only once\n        map.current = new mapboxgl.Map({\n            container: mapContainer.current,\n            style: 'mapbox://styles/mapbox/streets-v11',\n            center: [lng, lat],\n            //center: [-77.034084, 38.909671],\n            zoom: zoom\n        });\n        map.current.on('load', () => {\n            /* Add the data to your map as a layer \n            \n            map.current.addLayer({\n              id: 'locations',\n              type: 'circle',\n              // Add a GeoJSON source containing place coordinates and information.\n              source: {\n                type: 'geojson',\n                data: stores\n              }\n            });\n            */\n            // This function is for to load custom markers\n            map.current.addSource('places', {\n                type: 'geojson',\n                data: stores\n            });\n            buildLocationList(stores);\n            addMarkers()\n        });\n\n        const addMarkers = () => {\n            /* For each feature in the GeoJSON object above: */\n            for (const marker of stores.features) {\n                /* Create a div element for the marker. */\n                const el = document.createElement('div');\n                /* Assign a unique `id` to the marker. */\n                el.id = `marker-${marker.properties.id}`;\n                /* Assign the `marker` class to each marker for styling. */\n                el.className = 'marker';\n\n                /**\n                 * Create a marker using the div element\n                 * defined above and add it to the map.\n                 **/\n                new mapboxgl.Marker(el, { offset: [0, -23] })\n                    .setLngLat(marker.geometry.coordinates)\n                    .addTo(map.current);\n\n                el.addEventListener('click', (e) => {\n                    /* Fly to the point */\n                    flyToStore(marker);\n                    /* Close all other popups and display popup for clicked store */\n                    createPopUp(marker);\n                    /* Highlight listing in sidebar */\n                    const activeItem = document.getElementsByClassName('active');\n                    e.stopPropagation();\n                    if (activeItem[0]) {\n                        activeItem[0].classList.remove('active');\n                    }\n                    const listing = document.getElementById(`listing-${marker.properties.id}`);\n                    listing.classList.add('active');\n                });\n            }\n        }\n        /*\n        map.current.on('click', ({ point }) => {\n          // Determine if a feature in the \"locations\" layer exists at that point. \n          const features = map.current.queryRenderedFeatures(point, {\n            layers: ['locations']\n          });\n      \n          // If it does not exist, return \n          if (!features.length) return;\n      \n          const clickedPoint = features[0];\n      \n          //Fly to the point \n          flyToStore(clickedPoint);\n      \n          // Close all other popups and display popup for clicked store \n          createPopUp(clickedPoint);\n      \n          // Highlight listing in sidebar (and remove highlight for all other listings) \n          const activeItem = document.getElementsByClassName('active');\n          if (activeItem[0]) {\n            activeItem[0].classList.remove('active');\n          }\n          const listing = document.getElementById(\n            `listing-${clickedPoint.properties.id}`\n          );\n          listing.classList.add('active');\n        });\n        */\n    });\n\n    useEffect(() => {\n        if (!map.current) return; // wait for map to initialize\n        map.current.on('move', () => {\n            setLng(map.current.getCenter().lng.toFixed(4));\n            setLat(map.current.getCenter().lat.toFixed(4));\n\n            setZoom(map.current.getZoom().toFixed(2));\n        });\n    });\n\n    return (\n        <div>\n            <div class='sidebar'>\n                <div class='heading'>\n                    <h1>Dealer Orders</h1>\n                </div>\n                <div id='listings' className='listings'></div>\n            </div>\n            <div ref={mapContainer} className=\"map\" />\n        </div>\n    );\n}\n//Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}\n\n\n"]},"metadata":{},"sourceType":"module"}